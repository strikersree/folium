<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Folium — PDF Converter</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --ink: #0f0e0d;
    --paper: #f5f0e8;
    --cream: #ede8dc;
    --amber: #c8860a;
    --amber-light: #f0a830;
    --rust: #9e3b1b;
    --muted: #7a7266;
    --border: #d4cec4;
    --card: #ffffff;
  }

  html { font-size: 16px; scroll-behavior: smooth; }

  body {
    font-family: 'Instrument Sans', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── NAV ── */
  nav {
    position: sticky; top: 0; z-index: 100;
    display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 2.5rem;
    background: var(--ink);
    border-bottom: 2px solid var(--amber);
  }
  .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 1.6rem; color: var(--paper);
    letter-spacing: 0.02em;
  }
  .logo span { color: var(--amber); font-style: italic; }
  .nav-links { display: flex; gap: 0.5rem; }
  .nav-btn {
    font-family: 'DM Mono', monospace; font-size: 0.78rem; font-weight: 500;
    padding: 0.45rem 1.1rem;
    border: 1.5px solid transparent;
    border-radius: 3px; cursor: pointer;
    text-transform: uppercase; letter-spacing: 0.08em;
    transition: all 0.18s;
    background: transparent; color: var(--paper);
  }
  .nav-btn:hover { border-color: var(--amber); color: var(--amber); }
  .nav-btn.active { background: var(--amber); color: var(--ink); border-color: var(--amber); }

  /* ── PAGES ── */
  .page { display: none; }
  .page.visible { display: block; }

  /* ── HERO ── */
  .hero {
    text-align: center;
    padding: 4rem 2rem 2.5rem;
    position: relative;
  }
  .hero::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      90deg, transparent, transparent 60px,
      rgba(200,134,10,0.04) 60px, rgba(200,134,10,0.04) 61px
    );
    pointer-events: none;
  }
  .hero-eyebrow {
    font-family: 'DM Mono', monospace; font-size: 0.72rem;
    text-transform: uppercase; letter-spacing: 0.15em;
    color: var(--amber); margin-bottom: 1rem;
  }
  .hero h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2.6rem, 6vw, 4.2rem);
    line-height: 1.1; color: var(--ink);
    max-width: 700px; margin: 0 auto 1.2rem;
  }
  .hero h1 em { color: var(--amber); font-style: italic; }
  .hero p {
    font-size: 1.05rem; color: var(--muted);
    max-width: 480px; margin: 0 auto;
    line-height: 1.65;
  }

  /* ── CONVERTER CARD ── */
  .converter {
    max-width: 820px; margin: 0 auto;
    padding: 0 1.5rem 5rem;
  }

  /* Drop Zone */
  .drop-zone {
    border: 2.5px dashed var(--border);
    border-radius: 8px;
    background: var(--card);
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  .drop-zone::before {
    content: '';
    position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(200,134,10,0.04) 0%, transparent 60%);
    pointer-events: none;
  }
  .drop-zone:hover, .drop-zone.drag-over {
    border-color: var(--amber);
    background: #fff9f0;
  }
  .drop-zone.drag-over { transform: scale(1.01); }
  .drop-icon {
    width: 56px; height: 56px; margin: 0 auto 1.2rem;
    background: var(--ink); border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
  }
  .drop-icon svg { width: 26px; height: 26px; fill: var(--amber); }
  .drop-zone h3 {
    font-family: 'DM Serif Display', serif; font-size: 1.4rem;
    margin-bottom: 0.4rem;
  }
  .drop-zone p { color: var(--muted); font-size: 0.9rem; margin-bottom: 1.2rem; }
  .drop-zone .file-types {
    font-family: 'DM Mono', monospace; font-size: 0.72rem;
    color: var(--muted); letter-spacing: 0.06em;
  }
  #fileInput { display: none; }

  .upload-btn {
    display: inline-flex; align-items: center; gap: 0.5rem;
    background: var(--ink); color: var(--paper);
    font-family: 'DM Mono', monospace; font-size: 0.8rem;
    text-transform: uppercase; letter-spacing: 0.1em;
    padding: 0.7rem 1.6rem; border-radius: 3px;
    border: none; cursor: pointer; margin-bottom: 1rem;
    transition: background 0.18s;
  }
  .upload-btn:hover { background: var(--amber); color: var(--ink); }

  /* File List */
  .file-list {
    margin-top: 1.5rem;
    display: flex; flex-direction: column; gap: 0.6rem;
  }
  .file-item {
    display: flex; align-items: center; gap: 0.85rem;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 6px; padding: 0.7rem 1rem;
    animation: slideIn 0.2s ease;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .file-thumb {
    width: 42px; height: 42px; border-radius: 4px;
    object-fit: cover; background: var(--cream);
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Mono', monospace; font-size: 0.6rem;
    color: var(--muted); text-transform: uppercase;
    overflow: hidden;
  }
  .file-thumb img { width: 100%; height: 100%; object-fit: cover; }
  .file-info { flex: 1; min-width: 0; }
  .file-name { font-size: 0.88rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .file-size { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--muted); }
  .file-remove {
    background: none; border: none; cursor: pointer;
    color: var(--muted); font-size: 1.2rem; line-height: 1;
    transition: color 0.15s; padding: 0.2rem;
  }
  .file-remove:hover { color: var(--rust); }

  /* Options Panel */
  .options-panel {
    margin-top: 1.5rem;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 8px; padding: 1.6rem;
    display: none;
  }
  .options-panel.visible { display: block; animation: slideIn 0.25s ease; }
  .options-title {
    font-family: 'DM Mono', monospace; font-size: 0.72rem;
    text-transform: uppercase; letter-spacing: 0.12em;
    color: var(--muted); margin-bottom: 1.2rem;
  }
  .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  @media (max-width: 560px) { .options-grid { grid-template-columns: 1fr; } }

  .option-group label {
    display: block; font-size: 0.85rem; font-weight: 600;
    margin-bottom: 0.6rem;
  }
  .quality-btns { display: flex; gap: 0.4rem; }
  .q-btn {
    flex: 1;
    font-family: 'DM Mono', monospace; font-size: 0.75rem;
    text-transform: uppercase; letter-spacing: 0.07em;
    padding: 0.55rem 0.5rem;
    background: var(--cream); color: var(--ink);
    border: 1.5px solid var(--border); border-radius: 4px;
    cursor: pointer; transition: all 0.15s;
  }
  .q-btn:hover { border-color: var(--amber); }
  .q-btn.active { background: var(--ink); color: var(--amber); border-color: var(--ink); }

  .quality-desc {
    font-size: 0.78rem; color: var(--muted);
    margin-top: 0.5rem; min-height: 1.2em;
  }

  /* Toggle Switch */
  .toggle-row {
    display: flex; align-items: center; justify-content: space-between;
  }
  .toggle-info p { font-size: 0.85rem; font-weight: 600; margin-bottom: 0.2rem; }
  .toggle-info small { font-size: 0.78rem; color: var(--muted); }
  .toggle {
    position: relative; width: 48px; height: 26px;
    flex-shrink: 0;
  }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .toggle-slider {
    position: absolute; inset: 0;
    background: var(--border); border-radius: 26px;
    cursor: pointer; transition: background 0.2s;
  }
  .toggle-slider::before {
    content: '';
    position: absolute; width: 20px; height: 20px;
    left: 3px; top: 3px;
    background: white; border-radius: 50%;
    transition: transform 0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .toggle input:checked + .toggle-slider { background: var(--amber); }
  .toggle input:checked + .toggle-slider::before { transform: translateX(22px); }

  /* Convert Button */
  .convert-btn {
    width: 100%; margin-top: 1.5rem;
    padding: 1rem;
    background: var(--ink); color: var(--paper);
    font-family: 'DM Serif Display', serif; font-size: 1.2rem;
    font-style: italic;
    border: none; border-radius: 6px;
    cursor: pointer; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 0.6rem;
    position: relative; overflow: hidden;
  }
  .convert-btn::after {
    content: '';
    position: absolute; inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s;
  }
  .convert-btn:hover { background: var(--amber); color: var(--ink); }
  .convert-btn:hover::after { transform: translateX(100%); }
  .convert-btn:disabled {
    background: var(--border); color: var(--muted); cursor: not-allowed;
  }
  .convert-btn:disabled::after { display: none; }

  /* Progress */
  .progress-wrap {
    margin-top: 1rem;
    display: none;
  }
  .progress-wrap.visible { display: block; }
  .progress-bar-bg {
    height: 4px; background: var(--border); border-radius: 2px; overflow: hidden;
  }
  .progress-bar {
    height: 100%; width: 0%;
    background: linear-gradient(90deg, var(--amber), var(--amber-light));
    border-radius: 2px;
    transition: width 0.3s ease;
  }
  .progress-label {
    font-family: 'DM Mono', monospace; font-size: 0.75rem;
    color: var(--muted); margin-top: 0.4rem;
  }

  /* Success Toast */
  .toast {
    position: fixed; bottom: 2rem; right: 2rem;
    background: var(--ink); color: var(--paper);
    padding: 0.9rem 1.4rem; border-radius: 6px;
    border-left: 3px solid var(--amber);
    font-size: 0.9rem;
    box-shadow: 0 8px 24px rgba(0,0,0,0.25);
    transform: translateY(120%); opacity: 0;
    transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    z-index: 999;
    display: flex; align-items: center; gap: 0.6rem;
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* ── SIGN UP PAGE ── */
  .signup-page {
    min-height: calc(100vh - 65px);
    display: flex; align-items: center; justify-content: center;
    padding: 3rem 1.5rem;
    background: var(--paper);
  }
  .signup-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    padding: 3rem 2.5rem;
    max-width: 420px; width: 100%;
    box-shadow: 0 16px 48px rgba(0,0,0,0.07);
    position: relative;
    overflow: hidden;
  }
  .signup-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, var(--amber), var(--amber-light), var(--rust));
  }
  .signup-card h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 2rem; margin-bottom: 0.4rem;
  }
  .signup-card p { color: var(--muted); font-size: 0.9rem; margin-bottom: 2rem; line-height: 1.6; }

  .divider {
    display: flex; align-items: center; gap: 0.75rem;
    margin: 1.5rem 0; color: var(--muted);
    font-size: 0.78rem; font-family: 'DM Mono', monospace;
    text-transform: uppercase; letter-spacing: 0.1em;
  }
  .divider::before, .divider::after {
    content: ''; flex: 1; height: 1px; background: var(--border);
  }

  .oauth-btn {
    width: 100%; padding: 0.8rem 1rem;
    display: flex; align-items: center; gap: 0.85rem;
    background: var(--paper); color: var(--ink);
    border: 1.5px solid var(--border);
    border-radius: 6px; cursor: pointer;
    font-family: 'Instrument Sans', sans-serif; font-size: 0.9rem; font-weight: 500;
    transition: all 0.18s; margin-bottom: 0.7rem;
  }
  .oauth-btn:hover { border-color: var(--ink); background: var(--cream); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
  .oauth-btn svg { flex-shrink: 0; }

  .signup-footer {
    margin-top: 1.5rem; text-align: center;
    font-size: 0.8rem; color: var(--muted);
  }
  .signup-footer a { color: var(--amber); text-decoration: none; font-weight: 500; }
  .signup-footer a:hover { text-decoration: underline; }

  .terms {
    margin-top: 1.2rem; font-size: 0.75rem; color: var(--muted);
    text-align: center; line-height: 1.5;
  }
  .terms a { color: var(--muted); text-decoration: underline; }

  /* Empty state badge */
  .empty-badge {
    display: inline-flex; align-items: center; gap: 0.4rem;
    background: var(--cream); border: 1px solid var(--border);
    border-radius: 20px; padding: 0.3rem 0.8rem;
    font-family: 'DM Mono', monospace; font-size: 0.7rem;
    color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em;
    margin-top: 0.5rem;
  }
  .empty-badge::before { content: '●'; color: var(--amber); font-size: 0.5rem; }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">Foli<span>um</span></div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="showPage('home')">Converter</button>
    <button class="nav-btn" onclick="showPage('signup')">Sign Up</button>
  </div>
</nav>

<!-- HOME PAGE -->
<div id="page-home" class="page visible">
  <div class="hero">
    <p class="hero-eyebrow">⬡ Browser-based · No uploads to server</p>
    <h1>Turn anything into<br /><em>perfect PDFs</em></h1>
    <p>Drag in images and documents. Choose quality, merge if you like, and download instantly — all in your browser.</p>
  </div>

  <div class="converter">
    <!-- Drop Zone -->
    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
      <div class="drop-icon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L7 7h3v8h4V7h3L12 2zm-7 14v4h14v-4h-2v2H7v-2H5z"/>
        </svg>
      </div>
      <h3>Drop files here</h3>
      <p>or click to browse from your computer</p>
      <button class="upload-btn" onclick="event.stopPropagation(); document.getElementById('fileInput').click()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        Select Files
      </button>
      <div class="file-types">JPG · PNG · GIF · WEBP · BMP · PDF · TXT</div>
      <div class="empty-badge" id="fileCount">0 files selected</div>
    </div>
    <input type="file" id="fileInput" multiple accept="image/*,.txt,.pdf" />

    <!-- File List -->
    <div class="file-list" id="fileList"></div>

    <!-- Options -->
    <div class="options-panel" id="optionsPanel">
      <div class="options-title">// Conversion Options</div>
      <div class="options-grid">

        <div class="option-group">
          <label>PDF Quality</label>
          <div class="quality-btns">
            <button class="q-btn" data-q="low" onclick="setQuality('low')">Low</button>
            <button class="q-btn active" data-q="medium" onclick="setQuality('medium')">Medium</button>
            <button class="q-btn" data-q="high" onclick="setQuality('high')">High</button>
          </div>
          <div class="quality-desc" id="qualityDesc">Balanced size and clarity</div>
        </div>

        <div class="option-group">
          <label>Output</label>
          <div class="toggle-row" style="padding-top:0.3rem">
            <div class="toggle-info">
              <p>Merge into one PDF</p>
              <small id="mergeDesc">Each file → separate PDF</small>
            </div>
            <label class="toggle">
              <input type="checkbox" id="mergeToggle" onchange="toggleMerge()" />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

      </div>

      <button class="convert-btn" id="convertBtn" onclick="convertFiles()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6 2v6l2 2-2 2v6l6-4 6 4v-6l-2-2 2-2V2l-6 4-6-4z"/></svg>
        Convert to PDF
      </button>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-bar-bg"><div class="progress-bar" id="progressBar"></div></div>
        <div class="progress-label" id="progressLabel">Processing…</div>
      </div>
    </div>
  </div>
</div>

<!-- SIGN UP PAGE -->
<div id="page-signup" class="page">
  <div class="signup-page">
    <div class="signup-card">
      <h2>Join Folium</h2>
      <p>Create a free account to save conversion history, access high-res exports, and unlock batch processing.</p>

      <button class="oauth-btn" onclick="oauthClick('Google')">
        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Continue with Google
      </button>

      <button class="oauth-btn" onclick="oauthClick('Microsoft')">
        <svg width="20" height="20" viewBox="0 0 24 24"><rect x="1" y="1" width="10" height="10" fill="#F25022"/><rect x="13" y="1" width="10" height="10" fill="#7FBA00"/><rect x="1" y="13" width="10" height="10" fill="#00A4EF"/><rect x="13" y="13" width="10" height="10" fill="#FFB900"/></svg>
        Continue with Microsoft
      </button>

      <button class="oauth-btn" onclick="oauthClick('Apple')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="#000"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>
        Continue with Apple
      </button>

      <div class="terms">
        By creating an account, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
      </div>

      <div class="signup-footer">
        Already have an account? <a href="#" onclick="showPage('home')">Start converting →</a>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="var(--amber)"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
  <span id="toastMsg">PDF downloaded!</span>
</div>

<script>
// ── State ──
let files = [];
let quality = 'medium';
let merge = false;

const qualityMap = {
  low:    { res: 0.6, desc: 'Smaller file · lower resolution' },
  medium: { res: 0.85, desc: 'Balanced size and clarity' },
  high:   { res: 1.0, desc: 'Maximum quality · larger file' }
};

// ── Navigation ──
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('visible'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('visible');
  document.querySelectorAll('.nav-btn').forEach(b => {
    if (b.textContent.toLowerCase().includes(name === 'home' ? 'conv' : 'sign')) b.classList.add('active');
  });
}

// ── Drag & Drop ──
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => {
  e.preventDefault(); dropZone.classList.remove('drag-over');
  addFiles(Array.from(e.dataTransfer.files));
});
document.getElementById('fileInput').addEventListener('change', e => {
  addFiles(Array.from(e.target.files));
  e.target.value = '';
});

// ── File Handling ──
function addFiles(newFiles) {
  const allowed = ['image/jpeg','image/png','image/gif','image/webp','image/bmp','text/plain','application/pdf'];
  newFiles.forEach(f => {
    if (allowed.includes(f.type) || f.name.endsWith('.txt')) {
      if (!files.find(x => x.name === f.name && x.size === f.size)) files.push(f);
    }
  });
  renderFileList();
}

function removeFile(idx) {
  files.splice(idx, 1);
  renderFileList();
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1048576) return (bytes/1024).toFixed(1) + ' KB';
  return (bytes/1048576).toFixed(1) + ' MB';
}

function fileExt(name) { return name.split('.').pop().toUpperCase(); }

function renderFileList() {
  const list = document.getElementById('fileList');
  const count = document.getElementById('fileCount');
  const panel = document.getElementById('optionsPanel');

  count.textContent = files.length + ' file' + (files.length !== 1 ? 's' : '') + ' selected';

  list.innerHTML = '';
  files.forEach((f, i) => {
    const item = document.createElement('div');
    item.className = 'file-item';
    const isImg = f.type.startsWith('image/');
    item.innerHTML = `
      <div class="file-thumb" id="thumb-${i}">${fileExt(f.name)}</div>
      <div class="file-info">
        <div class="file-name">${f.name}</div>
        <div class="file-size">${formatSize(f.size)}</div>
      </div>
      <button class="file-remove" onclick="removeFile(${i})" title="Remove">✕</button>
    `;
    list.appendChild(item);
    if (isImg) {
      const reader = new FileReader();
      reader.onload = e => {
        const thumb = document.getElementById('thumb-' + i);
        if (thumb) thumb.innerHTML = `<img src="${e.target.result}" alt="" />`;
      };
      reader.readAsDataURL(f);
    }
  });

  panel.classList.toggle('visible', files.length > 0);
}

// ── Options ──
function setQuality(q) {
  quality = q;
  document.querySelectorAll('.q-btn').forEach(b => b.classList.toggle('active', b.dataset.q === q));
  document.getElementById('qualityDesc').textContent = qualityMap[q].desc;
}

function toggleMerge() {
  merge = document.getElementById('mergeToggle').checked;
  document.getElementById('mergeDesc').textContent = merge
    ? 'All files → one PDF'
    : 'Each file → separate PDF';
}

// ── OAuth Mock ──
function oauthClick(provider) {
  showToast(`Redirecting to ${provider}…`);
  setTimeout(() => showPage('home'), 1800);
}

// ── Toast ──
function showToast(msg) {
  const toast = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ── Conversion ──
async function convertFiles() {
  if (!files.length) return;
  const btn = document.getElementById('convertBtn');
  const progressWrap = document.getElementById('progressWrap');
  const progressBar = document.getElementById('progressBar');
  const progressLabel = document.getElementById('progressLabel');

  btn.disabled = true;
  progressWrap.classList.add('visible');
  progressBar.style.width = '0%';

  const { jsPDF } = window.jspdf;
  const imageFiles = files.filter(f => f.type.startsWith('image/'));
  const textFiles = files.filter(f => f.type === 'text/plain' || f.name.endsWith('.txt'));
  const existingPDFs = files.filter(f => f.type === 'application/pdf');

  const readAsDataURL = f => new Promise(res => {
    const r = new FileReader(); r.onload = e => res(e.target.result); r.readAsDataURL(f);
  });
  const readAsText = f => new Promise(res => {
    const r = new FileReader(); r.onload = e => res(e.target.result); r.readAsText(f);
  });

  const qualityVal = qualityMap[quality].res;
  const processable = [...imageFiles, ...textFiles];

  if (merge) {
    const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
    const pw = doc.internal.pageSize.getWidth();
    const ph = doc.internal.pageSize.getHeight();
    let first = true;

    for (let i = 0; i < processable.length; i++) {
      const f = processable[i];
      const pct = Math.round((i / processable.length) * 90);
      progressBar.style.width = pct + '%';
      progressLabel.textContent = `Processing ${f.name}…`;
      await new Promise(r => setTimeout(r, 10));

      if (!first) doc.addPage();
      first = false;

      if (f.type.startsWith('image/')) {
        const dataUrl = await readAsDataURL(f);
        const img = await new Promise(res => {
          const el = new Image(); el.onload = () => res(el); el.src = dataUrl;
        });
        const ratio = Math.min(pw / img.width, ph / img.height);
        const w = img.width * ratio, h = img.height * ratio;
        const x = (pw - w) / 2, y = (ph - h) / 2;
        const fmt = f.type === 'image/png' ? 'PNG' : 'JPEG';
        doc.addImage(dataUrl, fmt, x, y, w, h, undefined, qualityVal < 1 ? 'FAST' : 'NONE');
      } else {
        const text = await readAsText(f);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        const lines = doc.splitTextToSize(text, pw - 80);
        doc.text(lines, 40, 50);
      }
    }
    progressBar.style.width = '100%';
    progressLabel.textContent = 'Saving PDF…';
    await new Promise(r => setTimeout(r, 200));
    doc.save('folium-merged.pdf');

  } else {
    for (let i = 0; i < processable.length; i++) {
      const f = processable[i];
      const pct = Math.round((i / processable.length) * 90);
      progressBar.style.width = pct + '%';
      progressLabel.textContent = `Converting ${f.name}…`;
      await new Promise(r => setTimeout(r, 10));

      const doc = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
      const pw = doc.internal.pageSize.getWidth();
      const ph = doc.internal.pageSize.getHeight();

      if (f.type.startsWith('image/')) {
        const dataUrl = await readAsDataURL(f);
        const img = await new Promise(res => {
          const el = new Image(); el.onload = () => res(el); el.src = dataUrl;
        });
        const ratio = Math.min(pw / img.width, ph / img.height);
        const w = img.width * ratio, h = img.height * ratio;
        const x = (pw - w) / 2, y = (ph - h) / 2;
        const fmt = f.type === 'image/png' ? 'PNG' : 'JPEG';
        doc.addImage(dataUrl, fmt, x, y, w, h, undefined, qualityVal < 1 ? 'FAST' : 'NONE');
      } else {
        const text = await readAsText(f);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        const lines = doc.splitTextToSize(text, pw - 80);
        doc.text(lines, 40, 50);
      }
      const outName = f.name.replace(/\.[^.]+$/, '') + '.pdf';
      doc.save(outName);
      await new Promise(r => setTimeout(r, 300));
    }
  }

  if (existingPDFs.length) {
    progressLabel.textContent = 'Note: Existing PDFs are downloaded as-is';
    existingPDFs.forEach(f => {
      const url = URL.createObjectURL(f);
      const a = document.createElement('a');
      a.href = url; a.download = f.name; a.click();
      URL.revokeObjectURL(url);
    });
  }

  progressBar.style.width = '100%';
  await new Promise(r => setTimeout(r, 300));
  progressWrap.classList.remove('visible');
  btn.disabled = false;

  const n = processable.length + existingPDFs.length;
  showToast(`${n} PDF${n !== 1 ? 's' : ''} downloaded successfully!`);

  files = [];
  renderFileList();
}
</script>
</body>
</html>
